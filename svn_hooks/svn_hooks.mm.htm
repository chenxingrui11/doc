<html xmlns="http://www.w3.org/1999/xhtml"><!--This file has been created with freemind2html.xsl--><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Subversion Hooks</title><link rel="stylesheet" href="/docbook/includes/css/docbook.css" type="text/css"></link><link rel="stylesheet" href="/stylesheets/master.css" type="text/css"></link><link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css"></link><link rel="stylesheet" href="/docbook/includes/css/freemind2html.css" type="text/css"></link><meta name="generator" content="FreeMind-XSL Stylesheet (see: http://freemind-xsl.dev.slash-me.net/ for details)"></meta><script type="text/javascript"><!--
          
               function toggle(id)
               {
                   div_el = document.getElementById(id);
                   img_el = document.getElementById('img'+id);
                   if (div_el.style.display != 'none')
                   {
          
					
                      div_el.style.display='none';
                      img_el.src = '/docbook/includes/images/freemind/show.png';
          
                   }
                   else
                   {
          
                      div_el.style.display='block';
                      img_el.src = '/docbook/includes/images/freemind/hide.png';
          
                   };
               };
          
	--></script></head><body><script type="text/javascript" src="/docbook/includes/js/header.js"></script><script type="text/javascript">
	  write_header("/docbook");
	</script><h1>Subversion Hooks</h1><script type="text/javascript" src="/docbook/includes/mmflash/mmflash.js"></script><style type="text/css">
		#flashcontent {
			height: 100%;
		}
	</style><script type="text/javascript"><!--

		var hasReqestedVersion = DetectFlashVer(7, 0, 19);
		if (hasReqestedVersion) {
			FlashObject(

				"movie", "/docbook/includes/mmflash/visorFreemind.swf",

				"width", "100%",
				"height", "500",
				"align", "middle",
				"quality", "high",
				"bgcolor", "#FFFFFF",
				"id", "visorFreeMind",
				"name", "visorFreeMind",
				"openUrl", "_blank",

				"initLoadFile", "svn_hooks.mm",

				"startCollapsedToLevel", "5",
				'codebase', 'http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab#version=7,0,19,0',
				"pluginspage", "http://www.adobe.com/go/getflashplayer"
			);
		} else {
			var alternateContent = '<div id="flashcontent">'
			+ 'This content requires the Adobe Flash Player. <br/>'
			+ 'Flash Plugin version 7.0 or higher is needed. '
			+ '<a href="http://www.adobe.com/go/getflashplayer/">Get Flash</a>'
			+ '</div>';
			document.write(alternateContent);
		}

		--></script><noscript><div id="flashcontent">
			Flash plugin or Javascript are turned off.
			Activate both and reload to view the mindmap.<br></br><a href="http://www.adobe.com/go/getflash/">Get Flash</a></div></noscript><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp1520")' id="imgidp1520"></img><a id="FMFreemind_Link_249448778FM"></a><div class="nodecontent">Subversion Hooks</div><div class="content" id="idp1520"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp2336")' id="imgidp2336"></img><a id="FMFreemind_Link_1829461756FM"></a><div class="nodecontent">前言</div><div class="content" id="idp2336"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp3360")' id="imgidp3360"></img><a id="FMFreemind_Link_242631253FM"></a><div class="nodecontent">Subversion 被视为 CVS 的替代者</div><div class="content" id="idp3360"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_319218594FM"></a><div class="nodecontent">它改进了 CVS 恼人的文件名、目录名修改等多个 CVS 的痼疾</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1600937407FM"></a><div class="nodecontent">它最大限度的保持了和 CVS 的一致，照顾了 CVS 的使用习惯</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp6048")' id="imgidp6048"></img><a id="FMFreemind_Link_635219551FM"></a><div class="nodecontent">Subversion 也支持扩展，成为 Hooks（钩子脚本），类似于 CVS 的 CVSROOT 脚本扩展</div><div class="content" id="idp6048"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp7088")' id="imgidp7088"></img><a id="FMFreemind_Link_1711793052FM"></a><div class="nodecontent">CVSROOT 脚本扩展可以参见 WHODO 的这篇文章</div><div class="content" id="idp7088"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1350655655FM"></a><div class="nodecontent"><a href="http://www.worldhello.net/doc/cvs_vs_starteam/">《CVS Howto》</a> <a href="http://www.worldhello.net/doc/cvs_vs_starteam/"><img src="/docbook/includes/images/freemind/ilink.png" alt="User Link" style="border-width:0"></img></a></div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_755276861FM"></a><div class="nodecontent">WHODO 项目采用 Subversion 作为版本控制系统。本文介绍了 WHODO SVN 的 Hooks 定制</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1125508649FM"></a><div class="nodecontent">本文的 Hooks 脚本仅在 svn 1.1.4 和 svn 1.3.1 上进行过测试。</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp10800")' id="imgidp10800"></img><a id="FMFreemind_Link_12955572FM"></a><div class="nodecontent">Hooks 定制的注意事项</div><div class="content" id="idp10800"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp11856")' id="imgidp11856"></img><a id="FMFreemind_Link_1989410224FM"></a><div class="nodecontent">1. 权限：脚本是否具有可执行权限？</div><div class="content" id="idp11856"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1858690837FM"></a><div class="nodecontent">chmod a+rx</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp13616")' id="imgidp13616"></img><a id="FMFreemind_Link_1762018234FM"></a><div class="nodecontent">2. 不要依赖系统的环境变量，尤其是 PATH</div><div class="content" id="idp13616"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1266356959FM"></a><div class="nodecontent">为安全计，svn 执行脚本的环境变量为空
</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_439307246FM"></a><div class="nodecontent">命令使用绝对路径，或者定义 PATH 环境</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp16080")' id="imgidp16080"></img><a id="FMFreemind_Link_753438287FM"></a><div class="nodecontent">3. 并不是 STDERR 输出都返回控制台！</div><div class="content" id="idp16080"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_460453005FM"></a><div class="nodecontent">不要认为输出到 stderr 的错误信息都输出</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1787831403FM"></a><div class="nodecontent">只有 Hooks 运行失败，才将 STDERR 的输出传给 SVN 客户端</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp18624")' id="imgidp18624"></img><a id="FMFreemind_Link_1613787524FM"></a><div class="nodecontent">4. DOS 格式还是 Unix 格式？</div><div class="content" id="idp18624"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1307968056FM"></a><div class="nodecontent">还有经常犯的一个错误是上传了 DOS 格式的脚本到 Linux/Unix 服务器</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_589332917FM"></a><div class="nodecontent">Linux 上可以用 dos2unix 命令将 DOS 换行符 0D0A 转换为 0A</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp21264")' id="imgidp21264"></img><a id="FMFreemind_Link_1873739551FM"></a><div class="nodecontent">5. pre-revprop-change 和 post-revprop-change</div><div class="content" id="idp21264"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_699425888FM"></a><div class="nodecontent">pre-commit, post-commit 脚本，只有 pre-commit 的返回值被检查，post-commit 即便运行错误，也不影响提交</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1798280722FM"></a><div class="nodecontent">但 pre-revprop-change 和 post-revprop-change 这两个脚本任何一个脚本错误，都导致对 revision 的属性修改失败。（实现似乎和手册中有出入）</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp24384")' id="imgidp24384"></img><a id="FMFreemind_Link_1002081301FM"></a><div class="nodecontent">SVN Hooks 介绍</div><div class="content" id="idp24384"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp25408")' id="imgidp25408"></img><a id="FMFreemind_Link_175478029FM"></a><div class="nodecontent">SVN Hooks 的位置</div><div class="content" id="idp25408"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1097509871FM"></a><div class="nodecontent">位于 Repository 的 hooks 目录下</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1102280622FM"></a><div class="nodecontent">每一个 Repository 对应一个 hooks 目录</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp27776")' id="imgidp27776"></img><a id="FMFreemind_Link_520027785FM"></a><div class="nodecontent">SVN Hooks 名称</div><div class="content" id="idp27776"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_71495052FM"></a><div class="nodecontent">SVN 1.3 有 9 个 Hooks 脚本，SVN Repository 刚刚配置完成，所有的 hooks 脚本以 .tmpl 扩展名存在。若要启用某个 hooks，去掉其 .tmpl 扩展名</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_699775495FM"></a><div class="nodecontent">$ ls repos/hooks/<br></br>post-commit.tmpl          post-unlock.tmpl          pre-revprop-change.tmpl<br></br>post-lock.tmpl            pre-commit.tmpl           pre-unlock.tmpl<br></br>post-revprop-change.tmpl  pre-lock.tmpl             start-commit.tmpl
</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1044753368FM"></a><div class="nodecontent">Windows：Windows 上是根据扩展名判断可执行文件的，因此需要有扩展名，可以为 .exe 或 .bat</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp31904")' id="imgidp31904"></img><a id="FMFreemind_Link_437655943FM"></a><div class="nodecontent">依赖的第三方软件</div><div class="content" id="idp31904"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp30064")' id="imgidp30064"></img><a id="FMFreemind_Link_465063730FM"></a><div class="nodecontent">CPAN</div><div class="content" id="idp30064"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_163524614FM"></a><div class="nodecontent">Config::IniFiles</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp34240")' id="imgidp34240"></img><a id="FMFreemind_Link_976955561FM"></a><div class="nodecontent">svn 的 SWIG python binding</div><div class="content" id="idp34240"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp35168")' id="imgidp35168"></img><a id="FMFreemind_Link_1364838873FM"></a><div class="nodecontent">测试是否已经正确安装</div><div class="content" id="idp35168"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1504094154FM"></a><div class="nodecontent">&gt;&gt;&gt; import sys<br></br>&gt;&gt;&gt; print sys.path<br></br>&gt;&gt;&gt; from svn import *
</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp36928")' id="imgidp36928"></img><a id="FMFreemind_Link_430064243FM"></a><div class="nodecontent">安装</div><div class="content" id="idp36928"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_687837226FM"></a><div class="nodecontent">SWIG</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp38560")' id="imgidp38560"></img><a id="FMFreemind_Link_1672419484FM"></a><div class="nodecontent">Subversion</div><div class="content" id="idp38560"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_344596333FM"></a><div class="nodecontent">make swig-py &amp;&amp; make install-swig-py</div></div></div></div></div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp40704")' id="imgidp40704"></img><img src="/docbook/includes/images/freemind/icons/password.png" alt="password"></img> <a id="FMFreemind_Link_1529978846FM"></a><div class="nodecontent"><a href="http://www.worldhello.net/doc/svn_hooks/hooks">下面分别介绍各个脚本以及可行的定制方案。脚本参见 hooks 目录。</a> <a href="http://www.worldhello.net/doc/svn_hooks/hooks"><img src="/docbook/includes/images/freemind/ilink.png" alt="User Link" style="border-width:0"></img></a></div><div class="content" id="idp40704"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><img src="/docbook/includes/images/freemind/icons/idea.png" alt="idea"></img> <a id="FMFreemind_Link_24574542FM"></a><div class="nodecontent">由于 Web 服务器限制，有的脚本可能无法从 web 直接下载。可以从 Whodo SVN 版本控制系统中下载。</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp44256")' id="imgidp44256"></img><a id="FMFreemind_Link_171468139FM"></a><div class="nodecontent">start-commit</div><div class="content" id="idp44256"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp45568")' id="imgidp45568"></img><a id="FMFreemind_Link_1265325155FM"></a><div class="nodecontent">说明</div><div class="content" id="idp45568"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1752246195FM"></a><div class="nodecontent">在客户端还没有向服务器提交数据之前，即还没有建立 Subversion transaction（缩写为 txn） 之前，执行执行该脚本</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_93978168FM"></a><div class="nodecontent">因此该脚本可以很快执行，不像其他 pre-commit, post-commit 脚本要等到数据传输完成之后才执行。</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_280993978FM"></a><div class="nodecontent">也因此，该脚本获取的信息有限，不堪大用</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp49120")' id="imgidp49120"></img><a id="FMFreemind_Link_1647790886FM"></a><div class="nodecontent">参数</div><div class="content" id="idp49120"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[1] REPOS-PATH   (the path to this repository)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[2] USER         (the authenticated user attempting to commit)</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp51216")' id="imgidp51216"></img><a id="FMFreemind_Link_391433966FM"></a><div class="nodecontent">定制：暂时关闭提交功能</div><div class="content" id="idp51216"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_196736307FM"></a><div class="nodecontent">如果 hooks 目录中存在文件 COMMIT_LOCK ，则暂时终止提交</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp53584")' id="imgidp53584"></img><a id="FMFreemind_Link_1940553893FM"></a><div class="nodecontent">代码示例</div><div class="content" id="idp53584"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_608923395FM"></a><div class="nodecontent">#!/bin/sh<br></br><br></br>REPOS="$1"<br></br>USER="$2"<br></br>TOOLS_DIR=$REPOS/hooks/scripts<br></br>LOCK_FILE=$REPOS/hooks/COMMIT_LOCK<br></br><br></br>if [ -f $LOCK_FILE ]; then<br></br>    if [ -s $LOCK_FILE ]; then<br></br>        # Characters in LOCK_FILE should be utf-8 format!<br></br>        cat $LOCK_FILE &gt;&amp;2<br></br>    else<br></br>        # echo "系统维护中，暂时禁止提交。" &gt;&amp;2<br></br>        echo "Under maintenance, commit not allowed this time." &gt;&amp;2<br></br>    fi<br></br>    exit 1<br></br>fi
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp56304")' id="imgidp56304"></img><a id="FMFreemind_Link_1547366246FM"></a><div class="nodecontent">定制：用户黑名单</div><div class="content" id="idp56304"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_444103219FM"></a><div class="nodecontent">如果 hooks 目录中存在 BLACK_LIST 文件，列在其中的用户，禁止提交</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp58352")' id="imgidp58352"></img><a id="FMFreemind_Link_1091827543FM"></a><div class="nodecontent">代码示例</div><div class="content" id="idp58352"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_157352368FM"></a><div class="nodecontent">BLACKLIST_FILE=$REPOS/hooks/BLACK_LIST<br></br><br></br># check black_list<br></br>if [ -s $BLACKLIST_FILE ]; then<br></br>    ( grep -v "^#" "$BLACKLIST_FILE" | grep -iwq "$USER" ) &amp;&amp; \<br></br>    echo "$USER is not allowed to commit." &gt;&amp;2 &amp;&amp; exit 1<br></br>fi
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp60624")' id="imgidp60624"></img><a id="FMFreemind_Link_1097493551FM"></a><div class="nodecontent">定制：禁止未登录用户提交</div><div class="content" id="idp60624"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1115859515FM"></a><div class="nodecontent">不过 SVN 的身份验证仅在需要时提供，因此好像此定制未必有效？</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp62912")' id="imgidp62912"></img><a id="FMFreemind_Link_404061532FM"></a><div class="nodecontent">代码示例</div><div class="content" id="idp62912"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_219150637FM"></a><div class="nodecontent">#!/bin/sh<br></br><br></br>REPOS="$1"<br></br>USER="$2"<br></br><br></br>if [ "x$USER" = "x" ]; then<br></br>    echo "You must login before you can commit." 1&gt;&amp;2<br></br>    exit 1<br></br>fi
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp65264")' id="imgidp65264"></img><a id="FM_FM"></a><div class="nodecontent">定制：简陋的权限控制示例</div><div class="content" id="idp65264"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_636590429FM"></a><div class="nodecontent">一般不在 start-commit 中进行访问控制，因为只能限制到 repository 一级，不能精细到 repository 内部的目录、文件，因此基本没有用处。</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp67696")' id="imgidp67696"></img><a id="FMFreemind_Link_1690496770FM"></a><div class="nodecontent">代码示例</div><div class="content" id="idp67696"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1885924736FM"></a><div class="nodecontent">case $REPOS in<br></br>/opt/svnhome/test)<br></br>    case $USER in<br></br>    jiangxin)<br></br>        exit 0<br></br>        ;;<br></br>    *)<br></br>        echo "User: $USER not allowed" &gt;&amp;2<br></br>        exit 1<br></br>        ;;<br></br>    esac<br></br>    ;;<br></br>*)<br></br>    echo "$REPOS is unchangeable for $USER" &gt;&amp;2<br></br>    exit 1<br></br>    ;;<br></br>esac
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp70080")' id="imgidp70080"></img><a id="FMFreemind_Link_1552604930FM"></a><div class="nodecontent">定制：检查 Repository 容量限制</div><div class="content" id="idp70080"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1741196235FM"></a><div class="nodecontent">参考: http://www.toutprogrammer.com/article_29_3.html</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp72064")' id="imgidp72064"></img><a id="FMFreemind_Link_115029409FM"></a><div class="nodecontent">代码示例</div><div class="content" id="idp72064"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_667237169FM"></a><div class="nodecontent">#!/bin/sh<br></br># 参考: http://www.toutprogrammer.com/article_29_3.html<br></br><br></br>PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:$PATH<br></br><br></br>REPOS="$1"<br></br>USER="$2"<br></br><br></br>MAX_SIZE=20480 # 20MB<br></br>repos_size=`du -s $REPOS | cut -f 1`<br></br><br></br>if [ $repos_size -gt $MAX_SIZE ]; then<br></br> echo "Repositroy $REPOS has exceeded maximum size: $MAX_SIZE" 1&gt;&amp;2<br></br> exit 1<br></br>fi<br></br><br></br>exit 0</div></div></div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp74672")' id="imgidp74672"></img><a id="FMFreemind_Link_350859661FM"></a><div class="nodecontent">pre-commit</div><div class="content" id="idp74672"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp75952")' id="imgidp75952"></img><a id="FMFreemind_Link_419498374FM"></a><div class="nodecontent">说明</div><div class="content" id="idp75952"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1260287394FM"></a><div class="nodecontent">在 Subversion transaction 完毕之后，在提交之前，执行该脚本</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_757618632FM"></a><div class="nodecontent">用 svnlook 可以查看 transaction 中包含的用户信息、提交信息等，具体参见 svnlook 命令帮助</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp79248")' id="imgidp79248"></img><a id="FMFreemind_Link_947833012FM"></a><div class="nodecontent">用途</div><div class="content" id="idp79248"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1545910634FM"></a><div class="nodecontent">检查 commit log 格式是否符合规范</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_388949523FM"></a><div class="nodecontent">精细的“写权限”检查。如果是限制对 repos 的读取，需要使用 mod_authz_svn 模块！</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp82128")' id="imgidp82128"></img><a id="FMFreemind_Link_1905120985FM"></a><div class="nodecontent">参数</div><div class="content" id="idp82128"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[1] REPOS-PATH   (the path to this repository)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[2] TXN-NAME     (the name of the txn about to be committed)</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp84096")' id="imgidp84096"></img><a id="FMFreemind_Link_560308880FM"></a><div class="nodecontent">定制：检查 Commit Log 长度</div><div class="content" id="idp84096"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp85616")' id="imgidp85616"></img><a id="FMFreemind_Link_465629507FM"></a><div class="nodecontent">bash</div><div class="content" id="idp85616"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1937254108FM"></a><div class="nodecontent">PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:$PATH<br></br><br></br>REPOS="$1"<br></br>TXN="$2"<br></br>TOOLS_DIR=$REPOS/hooks/scripts<br></br><br></br># Make sure that the log message contains some text.<br></br>SVNLOOK=/usr/local/bin/svnlook<br></br><br></br>commitlog=`$SVNLOOK log -t "$TXN" "$REPOS"`<br></br>case `echo -n ${commitlog}|wc -c` in<br></br>    0)<br></br>        echo "Commit log is blank, please write a comment for your commit." &gt;&amp;2<br></br>        exit 1<br></br>        ;;<br></br>    [1-2])<br></br>        echo "Commit log must greater than 2 characters." &gt;&amp;2<br></br>        exit 1<br></br>        ;;<br></br>    *)<br></br>        ;;<br></br>esac
</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp87472")' id="imgidp87472"></img><a id="FMFreemind_Link_291310660FM"></a><div class="nodecontent">python</div><div class="content" id="idp87472"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_221843120FM"></a><div class="nodecontent">因为我经常偷懒，输入一排相同字符（如 .............）当作 commit log</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1133818862FM"></a><div class="nodecontent">def check_strlen(log_msg, minLen):<br></br>    log_length = len(log_msg)<br></br><br></br>    if log_length &gt; 0:<br></br>        char = log_msg[0]<br></br>        char2= log_msg[-1]        <br></br>        idx=1<br></br>        while idx &lt; len(log_msg):<br></br>            if char == -1 and char2 == -1 and log_length &lt;= 0:<br></br>                break<br></br><br></br>            if (char == log_msg[idx]) and (char != -1):<br></br>                log_length = log_length - 1<br></br>                char = log_msg[idx]<br></br>            else:<br></br>                char = -1<br></br><br></br>            if (char2 == log_msg[-idx]) and (char2 != -1):<br></br>                log_length = log_length - 1<br></br>                char2 = log_msg[-idx]<br></br>            else:<br></br>                char2 = -1<br></br><br></br>            idx = idx + 1<br></br>    <br></br>    if log_length &lt; minLen:<br></br>        sys.stderr.write ("Commit log must greater than %d characters, or too simple.\n" % minLen)<br></br>        sys.exit(1)
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp90992")' id="imgidp90992"></img><a id="FMFreemind_Link_988229172FM"></a><div class="nodecontent">定制：检查 Commit Log 内容</div><div class="content" id="idp90992"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp93152")' id="imgidp93152"></img><a id="FMFreemind_Link_161346053FM"></a><div class="nodecontent">python</div><div class="content" id="idp93152"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_851727184FM"></a><div class="nodecontent">def check_pattern(log_msg):<br></br>    patterns = [<br></br>               #r'(issue\s*[#]?[0-9]+)|(new.*:)|(bugfix:)',<br></br>               ]<br></br>    for pat in patterns:<br></br>        if re.compile(pat, re.I).search(log_msg, 1):<br></br>            continue<br></br>        else:<br></br>            sys.stderr.write ("Cannot find pattern: '%s' in commit log.\n" % pat)<br></br>            sys.exit(1)<br></br>
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp95776")' id="imgidp95776"></img><a id="FMFreemind_Link_811796078FM"></a><div class="nodecontent">定制：检查是否有同名（大小写不同）文件存在</div><div class="content" id="idp95776"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1898018245FM"></a><div class="nodecontent">如果服务器 repository 中存在文件名只是在大小写上有区分的文件，这在 Unix/Linux 上没有问题。<br></br>但是当客户端为 Windows 时，将会造成各种古怪的现象。<br></br>此扩展用于 检查 Repository 是否有同名文件（只是大小写不同而已），如果检查到，作为冲突报错。</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp97104")' id="imgidp97104"></img><a id="FMFreemind_Link_1197362435FM"></a><div class="nodecontent">perl 实现</div><div class="content" id="idp97104"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1524744976FM"></a><div class="nodecontent">脚本 check-case-insensitive.pl</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1249815041FM"></a><div class="nodecontent">对于 svn 1.1.x 需要使用 perl 的实现，直接调用 svnlook 命令行</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp100336")' id="imgidp100336"></img><a id="FMFreemind_Link_1090032332FM"></a><div class="nodecontent">python 实现</div><div class="content" id="idp100336"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_986862169FM"></a><div class="nodecontent">check-case-insensitive.py</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1584924966FM"></a><div class="nodecontent">依赖 subversin SWIG BINDINGS for Python</div> <a onclick="getVisibleParents('FMFreemind_Link_976955561FM')" href="#FMFreemind_Link_976955561FM"><img src="/docbook/includes/images/freemind/ilink.png" class="ilink" alt="Arrow Link"></img></a></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp105008")' id="imgidp105008"></img><a id="FMFreemind_Link_879969591FM"></a><div class="nodecontent">定制：检查新增文件的 svn:mime-type，以及 svn:eol-style 设置</div><div class="content" id="idp105008"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">check-mime-type.pl</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp106576")' id="imgidp106576"></img><a id="FMFreemind_Link_1691230069FM"></a><div class="nodecontent">check-mime-type.py</div><div class="content" id="idp106576"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1565865854FM"></a><div class="nodecontent">根据 check-mime-type.pl 改写，主要是为了移植到 Windows 平台</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp108656")' id="imgidp108656"></img><a id="FMFreemind_Link_1894063315FM"></a><div class="nodecontent" style="font-size:100%;">定制：检查用户权限</div><div class="content" id="idp108656"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp110384")' id="imgidp110384"></img><a id="FMFreemind_Link_723034788FM"></a><div class="nodecontent">perl</div><div class="content" id="idp110384"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp111376")' id="imgidp111376"></img><a id="FMFreemind_Link_98876172FM"></a><div class="nodecontent">脚本 commit-access-control.pl </div><div class="content" id="idp111376"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><img src="/docbook/includes/images/freemind/icons/messagebox_warning.png" alt="messagebox_warning"></img> <a id="FMFreemind_Link_146049174FM"></a><div class="nodecontent">依赖 CPAN 的 Config::IniFiles 包</div> <a onclick="getVisibleParents('FMFreemind_Link_163524614FM')" href="#FMFreemind_Link_163524614FM"><img src="/docbook/includes/images/freemind/ilink.png" class="ilink" alt="Arrow Link"></img></a></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp115680")' id="imgidp115680"></img><a id="FMFreemind_Link_1373111112FM"></a><div class="nodecontent">配置文件 commit-access-control.cfg</div><div class="content" id="idp115680"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp116704")' id="imgidp116704"></img><a id="FMFreemind_Link_1546872934FM"></a><div class="nodecontent">说明</div><div class="content" id="idp116704"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp117696")' id="imgidp117696"></img><a id="FMFreemind_Link_727707778FM"></a><div class="nodecontent">INI 格式</div><div class="content" id="idp117696"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1446341946FM"></a><div class="nodecontent">后面的覆盖前面的权限</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp119584")' id="imgidp119584"></img><a id="FMFreemind_Link_344030860FM"></a><div class="nodecontent">每一节必须包含 match 关键字</div><div class="content" id="idp119584"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">match = PERL_REGEX</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp121248")' id="imgidp121248"></img><a id="FMFreemind_Link_1390261841FM"></a><div class="nodecontent">每一节必须包含 access 关键字</div><div class="content" id="idp121248"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">access = (read-only|read-write)</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp122912")' id="imgidp122912"></img><a id="FMFreemind_Link_767014781FM"></a><div class="nodecontent">可选的 users 关键字</div><div class="content" id="idp122912"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_279703555FM"></a><div class="nodecontent">如果没有 users 关键字，则针对所有用户</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp124720")' id="imgidp124720"></img><a id="FMFreemind_Link_1098541840FM"></a><div class="nodecontent">可以在一行写下多个用户名，用空格分隔</div><div class="content" id="idp124720"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">users = username1 [username2 [username3 [username4 ...]]]</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp126528")' id="imgidp126528"></img><a id="FMFreemind_Link_72520841FM"></a><div class="nodecontent">也可以多条 users 语句</div><div class="content" id="idp126528"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_603761920FM"></a><div class="nodecontent">users = username1 [username2]<br></br>users = username3 username4</div></div></div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp128672")' id="imgidp128672"></img><a id="FMFreemind_Link_208687515FM"></a><div class="nodecontent">示例</div><div class="content" id="idp128672"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_55544916FM"></a><div class="nodecontent">[Make everything read-only for all users]<br></br>match   = .*<br></br>access  = read-only<br></br><br></br>[Make project1 read-write for users Jane and Joe]<br></br>match  = ^(branches|tags|trunk)/project1<br></br>users  = jane joe<br></br>access = read-write<br></br><br></br>[However, we don't trust Joe with project1's Makefile]<br></br>match  = ^(branches|tags|trunk)/project1/Makefile<br></br>users  = joe<br></br>access = read-only</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp131280")' id="imgidp131280"></img><a id="FMFreemind_Link_105630929FM"></a><div class="nodecontent">缺点</div><div class="content" id="idp131280"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1890799099FM"></a><div class="nodecontent">ACL 控制功能没有下面的 python 脚本全面</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1300429277FM"></a><div class="nodecontent">没有用户分组设置</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp133808")' id="imgidp133808"></img><a id="FMFreemind_Link_1231142932FM"></a><div class="nodecontent">python</div><div class="content" id="idp133808"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1639551067FM"></a><div class="nodecontent">脚本 svnperms.py</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1190768767FM"></a><div class="nodecontent">配置文件 svnperms.conf</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp136336")' id="imgidp136336"></img><a id="FMFreemind_Link_1879999269FM"></a><div class="nodecontent">配置</div><div class="content" id="idp136336"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_120409017FM"></a><div class="nodecontent">一个配置文件可以被多个 Repository 共享</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp138128")' id="imgidp138128"></img><a id="FMFreemind_Link_156304679FM"></a><div class="nodecontent">定制用户组</div><div class="content" id="idp138128"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp139120")' id="imgidp139120"></img><a id="FMFreemind_Link_1815360303FM"></a><div class="nodecontent">可以包含多个 groups 节</div><div class="content" id="idp139120"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_924898227FM"></a><div class="nodecontent">[groups]<br></br>group1 = user1 user2</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp141024")' id="imgidp141024"></img><a id="FMFreemind_Link_1977296194FM"></a><div class="nodecontent">还可以包含只对 repository 有效的用户组</div><div class="content" id="idp141024"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_973312698FM"></a><div class="nodecontent">[repos_basename groups]<br></br>group2 = user5 user6</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1236731758FM"></a><div class="nodecontent">引用用户组时，前面加上一个 @ 符号，用以和 用户名 区分</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp143920")' id="imgidp143920"></img><a id="FMFreemind_Link_6350132FM"></a><div class="nodecontent">每个 repository 有一个 Section 与之对应</div><div class="content" id="idp143920"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_411327030FM"></a><div class="nodecontent">section 的名称默认为 repository 的 basename，即去掉前面目录部分</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp145920")' id="imgidp145920"></img><a id="FMFreemind_Link_405934291FM"></a><div class="nodecontent">Section 中的权限策略由 KV 对组成</div><div class="content" id="idp145920"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1293698447FM"></a><div class="nodecontent">KV 对的 KEY 由常规表达式组成，和修改的文件路径匹配</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1545532412FM"></a><div class="nodecontent">KV 对的 Value 定义用户访问控制。用户访问控制可以是多条访问控制策略用空格分开</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp148832")' id="imgidp148832"></img><a id="FMFreemind_Link_1376687684FM"></a><div class="nodecontent">访问控制策略格式： 用户列表(权限列表)</div><div class="content" id="idp148832"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_335582192FM"></a><div class="nodecontent">用户列表是逗号分开的用户或用户组</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1560301307FM"></a><div class="nodecontent">用户列表为 * 则代表所有用户</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_146664617FM"></a><div class="nodecontent">权限列表是用逗号分隔的权限组合组成</div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp152032")' id="imgidp152032"></img><a id="FMFreemind_Link_1965557205FM"></a><div class="nodecontent">三种权限</div><div class="content" id="idp152032"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp153024")' id="imgidp153024"></img><a id="FMFreemind_Link_723371794FM"></a><div class="nodecontent">add</div><div class="content" id="idp153024"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1278487954FM"></a><div class="nodecontent">增加权限</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp155200")' id="imgidp155200"></img><a id="FMFreemind_Link_728660956FM"></a><div class="nodecontent">remove</div><div class="content" id="idp155200"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_489501699FM"></a><div class="nodecontent">删除权限</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp156992")' id="imgidp156992"></img><a id="FMFreemind_Link_421100828FM"></a><div class="nodecontent">update</div><div class="content" id="idp156992"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_739563511FM"></a><div class="nodecontent">修改文件以及修改属性权限</div></div></div></div></div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp159216")' id="imgidp159216"></img><a id="FMFreemind_Link_291746832FM"></a><div class="nodecontent">Section 之间可以继承</div><div class="content" id="idp159216"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp160208")' id="imgidp160208"></img><a id="FMFreemind_Link_1290590895FM"></a><div class="nodecontent">如</div><div class="content" id="idp160208"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1118364385FM"></a><div class="nodecontent">[example5 extends example2]<br></br>releases/[^/]+/ = *(add)</div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp162768")' id="imgidp162768"></img><a id="FMFreemind_Link_1651656383FM"></a><div class="nodecontent">post-commit</div><div class="content" id="idp162768"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp164000")' id="imgidp164000"></img><a id="FMFreemind_Link_1502073500FM"></a><div class="nodecontent">说明</div><div class="content" id="idp164000"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1265906043FM"></a><div class="nodecontent">在提交之后，执行该脚本。提交已经完成，不可更改，因此本脚本的返回值被忽略</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_53423889FM"></a><div class="nodecontent">该脚本一般用于外发邮件</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp167472")' id="imgidp167472"></img><a id="FMFreemind_Link_585423310FM"></a><div class="nodecontent">参数</div><div class="content" id="idp167472"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[1] REPOS-PATH   (the path to this repository)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1307812559FM"></a><div class="nodecontent">[2] REV          (the number of the revision just committed)</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp169824")' id="imgidp169824"></img><a id="FMFreemind_Link_517327792FM"></a><div class="nodecontent">定制：发送邮件</div><div class="content" id="idp169824"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp170832")' id="imgidp170832"></img><a id="FMFreemind_Link_1366272873FM"></a><div class="nodecontent">perl</div><div class="content" id="idp170832"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp171824")' id="imgidp171824"></img><a id="FMFreemind_Link_647666954FM"></a><div class="nodecontent">commit-email.pl 脚本</div><div class="content" id="idp171824"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_522866990FM"></a><div class="nodecontent">语法: commit-email.pl REPOS REVNUM [[-m regex] [options] [email_addr ...]] ...</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp173792")' id="imgidp173792"></img><a id="FMFreemind_Link_1056997416FM"></a><div class="nodecontent">对于单个项目</div><div class="content" id="idp173792"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_612436782FM"></a><div class="nodecontent">单个项目，可以用简化的命令行语法</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1081319678FM"></a><div class="nodecontent">commit-email.pl REPOS REVNUM [email_addr ...]</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_636909829FM"></a><div class="nodecontent">单个项目有一个默认的配置项组。-m 匹配所有路径</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp177328")' id="imgidp177328"></img><a id="FMFreemind_Link_1818209814FM"></a><div class="nodecontent">同时支持多个项目</div><div class="content" id="idp177328"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_627150122FM"></a><div class="nodecontent">多个 -m 参数，形成多个配置项组： -m pattern --from EMAIL -s subject  EMAIL_ADDR </div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_47599674FM"></a><div class="nodecontent">commit-email.pl REPOS REVNUM  \<br></br>    -m pattern --from EMAIL -s subject  EMAIL_ADDR  \<br></br>    -m pattern --from EMAIL -s subject  EMAIL_ADDR   \<br></br>    -m pattern --from EMAIL -s subject  EMAIL_ADDR </div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp180464")' id="imgidp180464"></img><a id="FMFreemind_Link_773422517FM"></a><div class="nodecontent">示例</div><div class="content" id="idp180464"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1717572423FM"></a><div class="nodecontent">commit-email.pl  -m "^(trunk|branches|tags)/project1" -</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_364334517FM"></a><div class="nodecontent">commit-email.pl "$REPOS" "$REV" commit-watchers@example.org
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp183088")' id="imgidp183088"></img><a id="FMFreemind_Link_117535430FM"></a><div class="nodecontent">python</div><div class="content" id="idp183088"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_864016272FM"></a><div class="nodecontent">mailer.py</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_313911003FM"></a><div class="nodecontent">配置文件 mailer.conf</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_93757014FM"></a><div class="nodecontent">定制：与 Bugtracking 系统整合</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp186768")' id="imgidp186768"></img><a id="FMFreemind_Link_140350054FM"></a><div class="nodecontent">pre-revprop-change</div><div class="content" id="idp186768"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp188016")' id="imgidp188016"></img><a id="FMFreemind_Link_584700812FM"></a><div class="nodecontent">说明</div><div class="content" id="idp188016"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_294588507FM"></a><div class="nodecontent">在修改 revision 属性之前，执行该脚本</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_618089832FM"></a><div class="nodecontent">如果该脚本不存在，或者该脚本返回 false，则不进行修改 revision 属性操作</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_342198534FM"></a><div class="nodecontent">因为 revision 的属性是没有版本控制的，因此脚本最好提供一个备份的机制</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp192480")' id="imgidp192480"></img><a id="FMFreemind_Link_1130021024FM"></a><div class="nodecontent">参数</div><div class="content" id="idp192480"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_456433982FM"></a><div class="nodecontent">[1] REPOS-PATH   (the path to this repository)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[2] REVISION     (the revision being tweaked)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[3] USER         (the username of the person tweaking the property)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[4] PROPNAME     (the property being set on the revision)</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp195792")' id="imgidp195792"></img><a id="FMFreemind_Link_251547470FM"></a><div class="nodecontent">定制：只允许修改 svn:log，不允许修改其他属性（如 svn:author） </div><div class="content" id="idp195792"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_7308153FM"></a><div class="nodecontent">if [ "$ACTION" = "M" -a "$PROPNAME" = "svn:log" ]; then exit 0; fi<br></br><br></br>echo "Changing revision properties other than svn:log is prohibited" &gt;&amp;2<br></br>exit 1
</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp198240")' id="imgidp198240"></img><a id="FMFreemind_Link_1519043369FM"></a><div class="nodecontent">post-revprop-change</div><div class="content" id="idp198240"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp199488")' id="imgidp199488"></img><a id="FMFreemind_Link_573261508FM"></a><div class="nodecontent">说明</div><div class="content" id="idp199488"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_197175786FM"></a><div class="nodecontent">在修改 revision 属性之后，执行该脚本。因为修改稿已经完成，不可更改，因此本脚本的返回值被忽略（不过实际上的实现似乎是该脚本的正确执行与否影响属性修改）</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1186167411FM"></a><div class="nodecontent">一般用于触发邮件通知</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp202816")' id="imgidp202816"></img><a id="FMFreemind_Link_350935627FM"></a><div class="nodecontent">参数</div><div class="content" id="idp202816"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1582127363FM"></a><div class="nodecontent">[1] REPOS-PATH   (the path to this repository)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[2] REV          (the revision that was tweaked)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[3] USER         (the username of the person tweaking the property)</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><div class="nodecontent">[4] PROPNAME     (the property being set on the revision)</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp206304")' id="imgidp206304"></img><a id="FMFreemind_Link_1485945996FM"></a><div class="nodecontent">定制：发送邮件</div><div class="content" id="idp206304"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp207296")' id="imgidp207296"></img><a id="FMFreemind_Link_1778260598FM"></a><div class="nodecontent">perl</div><div class="content" id="idp207296"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp208288")' id="imgidp208288"></img><a id="FMFreemind_Link_1975729266FM"></a><div class="nodecontent">propchange-email.pl</div><div class="content" id="idp208288"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_282416210FM"></a><div class="nodecontent">语法: propchange-email.pl REPOS REVNUM  USER PROPNAME [[-m regex] [options] [email_addr ...]] ...</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp210496")' id="imgidp210496"></img><a id="FMFreemind_Link_1017572882FM"></a><div class="nodecontent">对于单个项目</div><div class="content" id="idp210496"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1680724163FM"></a><div class="nodecontent">单个项目，可以用简化的命令行语法</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_776757238FM"></a><div class="nodecontent">propchange-email.pl REPOS REVNUM   USER PROPNAME  [email_addr ...]</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1872553610FM"></a><div class="nodecontent">单个项目有一个默认的配置项组。-m 匹配所有路径</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp213840")' id="imgidp213840"></img><a id="FMFreemind_Link_56610123FM"></a><div class="nodecontent">同时支持多个项目</div><div class="content" id="idp213840"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1247003703FM"></a><div class="nodecontent">多个 -m 参数，形成多个配置项组： -m pattern --from EMAIL -s subject  EMAIL_ADDR </div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1872188513FM"></a><div class="nodecontent">propchange-email.pl REPOS REVNUM    USER PROPNAME \<br></br>    -m pattern --from EMAIL -s subject  EMAIL_ADDR  \<br></br>    -m pattern --from EMAIL -s subject  EMAIL_ADDR   \<br></br>    -m pattern --from EMAIL -s subject  EMAIL_ADDR </div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_841173021FM"></a><div class="nodecontent">python</div> <a onclick="getVisibleParents('FMFreemind_Link_117535430FM')" href="#FMFreemind_Link_117535430FM"><img src="/docbook/includes/images/freemind/ilink.png" class="ilink" alt="Arrow Link"></img></a></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp219648")' id="imgidp219648"></img><a id="FMFreemind_Link_283380550FM"></a><div class="nodecontent">pre-lock</div><div class="content" id="idp219648"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_391878944FM"></a><div class="nodecontent">说明：对文件进行加锁操作之前</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_606551952FM"></a><div class="nodecontent">定制：检查已经存在的 lock 的属主，如果是本人，允许 lock</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp222720")' id="imgidp222720"></img><a id="FMFreemind_Link_1996415090FM"></a><div class="nodecontent">post-lock</div><div class="content" id="idp222720"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1152833475FM"></a><div class="nodecontent">说明：对文件进行加锁操作之后</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_260529753FM"></a><div class="nodecontent">定制：发送邮件</div> <a onclick="getVisibleParents('FMFreemind_Link_117535430FM')" href="#FMFreemind_Link_117535430FM"><img src="/docbook/includes/images/freemind/ilink.png" class="ilink" alt="Arrow Link"></img></a></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp227488")' id="imgidp227488"></img><a id="FMFreemind_Link_1883158926FM"></a><div class="nodecontent">pre-unlock</div><div class="content" id="idp227488"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1389887725FM"></a><div class="nodecontent">说明：对文件进行解锁操作之前</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1476256192FM"></a><div class="nodecontent">定制：检查已经存在的 lock 的属主，如果是本人，允许 lock</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp230448")' id="imgidp230448"></img><a id="FMFreemind_Link_921605161FM"></a><div class="nodecontent">post-unlock</div><div class="content" id="idp230448"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1087943438FM"></a><div class="nodecontent">说明：对文件进行解锁操作之后</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1147463029FM"></a><div class="nodecontent">定制：发送邮件</div> <a onclick="getVisibleParents('FMFreemind_Link_117535430FM')" href="#FMFreemind_Link_117535430FM"><img src="/docbook/includes/images/freemind/ilink.png" class="ilink" alt="Arrow Link"></img></a></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp235216")' id="imgidp235216"></img><a id="FMFreemind_Link_319999180FM"></a><div class="nodecontent">Windows 平台上的 Subversion Hooks</div><div class="content" id="idp235216"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp236480")' id="imgidp236480"></img><a id="FMFreemind_Link_962435697FM"></a><div class="nodecontent">说明</div><div class="content" id="idp236480"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_713698479FM"></a><div class="nodecontent">Windows 上的可执行程序是依据扩展名识别的，因此 Hooks 脚本需要带扩展名。如 pre-commit.bat, 或者 pre-commit.exe</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_181256137FM"></a><div class="nodecontent">Windows 平台的 SVN Hooks，仍然沿用了 Unix 的脚本，因而需要安装 Perl, Python 等软件</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1401676405FM"></a><div class="nodecontent">更多的采用 Python 脚本，因为一些 Perl 脚本用到了命令管道等没有移植到 Windows 平台的 Perl Feature。</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_335852987FM"></a><div class="nodecontent">代码下载，参见</div> <a onclick="getVisibleParents('FMFreemind_Link_1529978846FM')" href="#FMFreemind_Link_1529978846FM"><img src="/docbook/includes/images/freemind/ilink.png" class="ilink" alt="Arrow Link"></img></a></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp242832")' id="imgidp242832"></img><a id="FMFreemind_Link_817594202FM"></a><div class="nodecontent">pre-commit.bat</div><div class="content" id="idp242832"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp243824")' id="imgidp243824"></img><a id="FMFreemind_Link_590165311FM"></a><div class="nodecontent">定制：检查 Commit Log 长度</div><div class="content" id="idp243824"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_234342505FM"></a><div class="nodecontent">commit_log_check.py</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp246240")' id="imgidp246240"></img><a id="FMFreemind_Link_1986187875FM"></a><div class="nodecontent">定制：检查 Commit Log 内容</div><div class="content" id="idp246240"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1237060903FM"></a><div class="nodecontent">commit_log_check.py</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp248656")' id="imgidp248656"></img><a id="FMFreemind_Link_947028944FM"></a><div class="nodecontent">定制：检查新增文件的 svn:mime-type，以及 svn:eol-style 设置</div><div class="content" id="idp248656"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1644449450FM"></a><div class="nodecontent">check-mime-type.py</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp250736")' id="imgidp250736"></img><a id="FMFreemind_Link_185206072FM"></a><div class="nodecontent">pre-revprop-change.bat</div><div class="content" id="idp250736"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1555773834FM"></a><div class="nodecontent">定制：只允许修改 svn:log，不允许修改其他属性（如 svn:author） </div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp252704")' id="imgidp252704"></img><a id="FMFreemind_Link_557084760FM"></a><div class="nodecontent">尚未实现功能</div><div class="content" id="idp252704"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1284603916FM"></a><div class="nodecontent">由于 subversion 的 Python Binding 在 Windows 平台的移植的困难，很多用到 svn python 模块的脚本没有移植。可以考虑将依赖 subversion python binding 的脚本用 svnlook 重写。</div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1439981208FM"></a><div class="nodecontent">邮件：可以考虑使用 Cygwin 的 exim, ssmtp 等替代 脚本中的 sendmail</div></div></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp255808")' id="imgidp255808"></img><a id="FMFreemind_Link_1982906981FM"></a><div class="nodecontent">关于本文</div><div class="content" id="idp255808"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp256992")' id="imgidp256992"></img><a id="FMFreemind_Link_452334831FM"></a><div class="nodecontent">作者</div><div class="content" id="idp256992"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp257984")' id="imgidp257984"></img><a id="FMFreemind_Link_1545358139FM"></a><div class="nodecontent">J</div><div class="content" id="idp257984"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1880872410FM"></a><div class="nodecontent"><a href="http://www.worldhello.net/about">Jiang Xin</a> <a href="http://www.worldhello.net/about"><img src="/docbook/includes/images/freemind/ilink.png" alt="User Link" style="border-width:0"></img></a></div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1128278540FM"></a><div class="nodecontent">等待你的加入...</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp261024")' id="imgidp261024"></img><a id="FMFreemind_Link_1726486432FM"></a><div class="nodecontent">版本</div><div class="content" id="idp261024"><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp262016")' id="imgidp262016"></img><a id="FMFreemind_Link_1675565747FM"></a><div class="nodecontent">0.2, 2006/5/8</div><div class="content" id="idp262016"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_1763737594FM"></a><div class="nodecontent">增加 Windows 上的 SVN Hooks 脚本;</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_784525211FM"></a><div class="nodecontent">0.1</div></div></div></div><div class="node"><img src="/docbook/includes/images/freemind/hide.png" class="hideshow" alt="hide" onClick='toggle("idp264784")' id="imgidp264784"></img><a id="FMFreemind_Link_1919660892FM"></a><div class="nodecontent">参考资料</div><div class="content" id="idp264784"><div class="node"><img src="/docbook/includes/images/freemind/leaf.png" class="hideshow" alt="leaf"></img><a id="FMFreemind_Link_562143718FM"></a><div class="nodecontent"><a href="http://svnbook.red-bean.com/">《Version Control with Subversion》</a> <a href="http://svnbook.red-bean.com/"><img src="/docbook/includes/images/freemind/ilink.png" alt="User Link" style="border-width:0"></img></a></div></div></div></div></div></div></div></div><script type="text/javascript" src="/docbook/includes/js/footer.js"></script><script type="text/javascript">
	  write_footer("/docbook");
	</script></body></html>
